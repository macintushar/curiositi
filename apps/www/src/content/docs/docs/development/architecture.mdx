---
title: ğŸ–§ Architecture
description: System architecture and technical overview of Curiositi
---

Curiositi is a monorepo built with Turborepo and Bun. This document explains the system architecture, data flow, and technical decisions.

## High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Client Layer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Browser (React 19)                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ HTTPS
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Application Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Platform (TanStack Start)                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚   Routes   â”‚ â”‚ Components â”‚ â”‚  TanStack Query    â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ (TanStack  â”‚ â”‚  (shadcn/  â”‚ â”‚  + tRPC Client     â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Router)   â”‚ â”‚   React)   â”‚ â”‚                    â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  tRPC v11  â”‚ â”‚ Vite 7 +   â”‚ â”‚  Tailwind CSS v4   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Server    â”‚ â”‚ Nitro SSR  â”‚ â”‚                    â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚ QStash (Upstash)                 â”‚
â”‚                              â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Worker (Hono on Bun)                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  POST      â”‚ â”‚ Processors â”‚ â”‚  Vercel AI SDK     â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ /process-  â”‚ â”‚ (doc,      â”‚ â”‚  (OpenAI + Google) â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  file      â”‚ â”‚  image)    â”‚ â”‚                    â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Data Layer                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        PostgreSQL            â”‚  â”‚     S3 Storage         â”‚   â”‚
â”‚  â”‚       (Drizzle ORM)          â”‚  â”‚      (Files)           â”‚   â”‚
â”‚  â”‚                              â”‚  â”‚                        â”‚   â”‚
â”‚  â”‚  â€¢ Users / Sessions          â”‚  â”‚  â€¢ Uploaded files      â”‚   â”‚
â”‚  â”‚  â€¢ Workspaces / Members      â”‚  â”‚                        â”‚   â”‚
â”‚  â”‚  â€¢ Spaces / Files            â”‚  â”‚                        â”‚   â”‚
â”‚  â”‚  â€¢ Embeddings (pgvector)     â”‚  â”‚                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Overview

### Platform (Web Application)

**Technology Stack:**
- **Framework:** React 19 + TanStack Start
- **Routing:** TanStack Router (file-based)
- **Data Fetching:** TanStack Query + tRPC v11
- **API:** tRPC for type-safe client-server communication
- **Styling:** Tailwind CSS v4 + shadcn/ui
- **Build Tool:** Vite 7 with Nitro for SSR
- **Auth:** Better Auth (Google OAuth + email/password)
- **Monitoring:** Sentry

**Key Directories:**
```
apps/platform/src/
â”œâ”€â”€ routes/           # TanStack Router route definitions
â”œâ”€â”€ components/       # React components
â”‚   â””â”€â”€ ui/          # shadcn/ui components
â”œâ”€â”€ pages/           # Page-level views
â”œâ”€â”€ layouts/         # Layout components
â”œâ”€â”€ integrations/    # tRPC client and server setup
â”œâ”€â”€ hooks/           # React hooks
â”œâ”€â”€ lib/             # Utilities (auth, upload, etc.)
â”œâ”€â”€ forms/           # Form components
â”œâ”€â”€ contexts/        # React contexts
â”œâ”€â”€ middleware/       # Server middleware
â””â”€â”€ env.ts           # Environment variable validation
```

### Worker (File Processing)

The worker is a Hono server running on Bun that processes uploaded files. It exposes a single `POST /process-file` endpoint, invoked by the platform via Upstash QStash.

**Technology Stack:**
- **Framework:** Hono
- **Runtime:** Bun (port 3040)
- **AI:** Vercel AI SDK (`ai` package) with OpenAI and Google providers
- **Queue:** Triggered via Upstash QStash

**Key Directories:**
```
apps/worker/src/
â”œâ”€â”€ processors/      # File type processors
â”‚   â”œâ”€â”€ doc.ts      # Document processor (PDF, text, etc.)
â”‚   â”œâ”€â”€ image.ts    # Image processor (JPEG, PNG, etc.)
â”‚   â””â”€â”€ types.ts    # Processor type definitions
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ chunk.ts    # Text chunking (800 tokens, 100 overlap)
â”‚   â””â”€â”€ md.ts       # Markdown utilities
â”œâ”€â”€ process-file.ts # Main file processing logic
â”œâ”€â”€ index.ts        # Hono server entry point
â””â”€â”€ env.ts          # Environment variable validation
```

### Database (PostgreSQL + pgvector)

**Technology Stack:**
- **Database:** PostgreSQL 14+ with pgvector extension
- **ORM:** Drizzle ORM
- **Migrations:** Drizzle Kit

**Key Tables:**
```
Better Auth Tables:
â”œâ”€â”€ user
â”œâ”€â”€ session
â”œâ”€â”€ account
â”œâ”€â”€ organization
â”œâ”€â”€ member
â””â”€â”€ verification

Curiositi Tables:
â”œâ”€â”€ spaces           # Hierarchical spaces (parentSpaceId for nesting)
â”œâ”€â”€ files            # File metadata (name, type, size, S3 key, status)
â”œâ”€â”€ fileContents     # Extracted content chunks + vector embeddings (1536d)
â””â”€â”€ filesInSpace     # Many-to-many junction table
```

### Shared Packages

```
packages/
â”œâ”€â”€ db/              # Database schema and Drizzle config
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ schema.ts   # All table definitions
â”‚       â”œâ”€â”€ client.ts   # Database client
â”‚       â””â”€â”€ index.ts    # Exports
â”œâ”€â”€ share/           # Shared utilities
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ ai/         # AI model definitions (OpenAI, Google)
â”‚       â”œâ”€â”€ constants/  # MIME types, file size limits, allowed types
â”‚       â”œâ”€â”€ fs/         # File system helpers
â”‚       â”œâ”€â”€ logger/     # Structured logging utility
â”‚       â”œâ”€â”€ schemas/    # Shared Zod schemas
â”‚       â””â”€â”€ types/      # Shared type definitions
â”œâ”€â”€ api-handlers/    # Shared API handler logic
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ upload.ts   # File upload handling
â”‚       â”œâ”€â”€ file.ts     # File operations
â”‚       â”œâ”€â”€ space.ts    # Space operations
â”‚       â”œâ”€â”€ queue.ts    # Queue job dispatching
â”‚       â””â”€â”€ response.ts # Response helpers
â”œâ”€â”€ queue/           # Upstash QStash job queue wrapper
â””â”€â”€ tsconfig/        # Shared TypeScript configurations
```

## Data Flow

### File Upload Flow

```
1. User Upload
   â”œâ”€ Browser â†’ Platform (tRPC or /api/upload)
   â””â”€ File uploaded to S3 storage

2. Metadata Storage
   â”œâ”€ File metadata saved to PostgreSQL
   â”œâ”€ Status set to "pending"
   â””â”€ Processing job dispatched via QStash

3. Background Processing (Worker)
   â”œâ”€ QStash invokes POST /process-file on Worker
   â”œâ”€ Worker downloads file from S3
   â”œâ”€ Content extracted (text from docs, description from images)
   â”œâ”€ Text chunked (800 tokens, 100 token overlap)
   â”œâ”€ Embeddings generated (1536-dimension vectors)
   â”œâ”€ Chunks + embeddings stored in fileContents table
   â””â”€ File status updated to "completed"

4. Search Ready
   â””â”€ File content is now searchable via vector similarity
```

### Search Flow

```
1. Query Received
   â”œâ”€ User enters natural language query
   â””â”€ Platform receives tRPC request

2. Embedding Generation
   â”œâ”€ Query text sent to embedding model
   â””â”€ Query embedding vector generated

3. Vector Search
   â”œâ”€ pgvector performs cosine similarity search
   â””â”€ Top matching chunks retrieved

4. Result Aggregation
   â”œâ”€ Chunks grouped by source file
   â””â”€ Results returned to user
```

### Authentication Flow

```
1. Login Request
   â”œâ”€ Email/password or Google OAuth
   â””â”€ Better Auth validates credentials

2. Session Created
   â”œâ”€ Session stored in PostgreSQL
   â””â”€ Cookie set in browser

3. Workspace Context
   â”œâ”€ User selects workspace
   â””â”€ All queries scoped to workspace

4. Authorization
   â”œâ”€ Each request checks session + workspace membership
   â””â”€ Resources filtered by workspace
```

## Technical Decisions

### Why Turborepo?

- **Code Sharing** â€” Shared packages (db, share, api-handlers, queue) reduce duplication
- **Build Optimization** â€” Turborepo caches and parallelizes builds
- **Unified Tooling** â€” Single lint (Biome), format, and type-check across the repo
- **Dependency Management** â€” Workspace protocol for internal dependencies

### Why TanStack Start?

- **File-based Routing** â€” Automatic route generation via TanStack Router
- **Type Safety** â€” End-to-end TypeScript with tRPC integration
- **SSR Support** â€” Built-in server-side rendering via Vite + Nitro
- **Developer Experience** â€” Hot reload and excellent dev tools

### Why Hono for Worker?

- **Performance** â€” Lightweight and fast, runs natively on Bun
- **Simplicity** â€” Single endpoint, minimal framework overhead
- **TypeScript Native** â€” Full type safety out of the box

### Why Drizzle ORM?

- **Type Safety** â€” Full TypeScript support with inferred types
- **SQL-like Syntax** â€” Familiar query building, close to raw SQL
- **Migration Support** â€” Drizzle Kit for schema generation and migrations
- **Performance** â€” Minimal overhead compared to heavier ORMs

### Why pgvector?

- **Native Integration** â€” Vector storage directly in PostgreSQL
- **Similarity Search** â€” Efficient nearest neighbor queries
- **No Additional Services** â€” No need for a separate vector database
- **ACID Compliance** â€” Transactional safety for embeddings alongside relational data

## Monitoring and Observability

### Logging

- **Structured Logging** â€” Custom logger in `packages/share/src/logger/`
- **Log Levels** â€” Debug, Info, Warn, Error

### Error Tracking

- **Sentry** â€” Integrated into the platform for error tracking and performance monitoring

## CI/CD

### GitHub Actions Workflows

```
ci.yml (on push/PR to main):
â”œâ”€ Format check (Biome)
â”œâ”€ Lint + type check (bun run check)
â””â”€ Commit message validation (commitlint)

test.yml (on push/PR to main):
â”œâ”€ Run tests (bun run test:coverage)
â””â”€ Upload coverage to Codecov

release.yml (weekly, Friday 00:00 UTC):
â”œâ”€ Generate changesets from commits
â”œâ”€ Version packages
â””â”€ Create GitHub releases/tags
```

### Deployment

- **Platform** â€” Deploys to Vercel (TanStack Start + Nitro)
- **Documentation (www)** â€” Deploys to Vercel (Starlight + Astro)
- **Worker** â€” Runs on Bun

## Development

### Local Development

```bash
# Start all services
bun run dev

# Services available:
# - Platform: http://localhost:3030
# - Worker:   http://localhost:3040
```

### Testing

The project uses Bun's built-in test runner and Playwright for E2E tests:

```bash
# Run tests with coverage
bun run test

# Run with lcov coverage output
bun run test:coverage
```

## Next Steps

- [Configuration](/docs/configuration) â€” Environment variables and settings
- [Core Concepts](/docs/core-concepts) â€” Understand the data model
- [Getting Started](/docs/getting-started) â€” Run Curiositi locally
